<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Phao Hoa</title>
<style>
  body {
    margin: 0;
    background: black;
    overflow: hidden;
  }
  canvas {
    display: block;
  }
</style>
</head>
<body>
<canvas id="fireworks"></canvas>

<script>
const canvas = document.getElementById('fireworks');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let fireworks = [];
const boomSounds = [
  new Audio("boom1.mp3"),
  new Audio("boom2.mp3"),
  new Audio("boom3.mp3")
];

function randColor() {
  return `hsl(${Math.random() * 360},100%,50%)`;
}

function playBoomSound() {
  let sound = boomSounds[Math.floor(Math.random() * boomSounds.length)];
  sound.currentTime = 0;
  sound.play();
}

function Firework(x, y, text, type) {
  this.x = x;
  this.y = canvas.height;
  this.tx = x;
  this.ty = y;
  this.color = randColor();
  this.text = text;
  this.speed = 6;
  this.exploded = false;
  this.particles = [];
  this.type = type;
}

Firework.prototype.update = function() {
  if (!this.exploded) {
    let dx = this.tx - this.x;
    let dy = this.ty - this.y;
    this.x += dx * 0.1;
    this.y += dy * 0.1;

    if (Math.abs(dx) < 2 && Math.abs(dy) < 2) {
      this.explode();
    }
  } else {
    this.particles.forEach((p, i) => {
      p.update();
      if (p.alpha <= 0) this.particles.splice(i, 1);
    });
  }
};

Firework.prototype.draw = function() {
  if (!this.exploded) {
    ctx.beginPath();
    ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
    ctx.fillStyle = this.color;
    ctx.fill();
  } else {
    this.particles.forEach(p => p.draw());
    ctx.fillStyle = this.color;
    ctx.font = "30px Arial";
    ctx.textAlign = "center";
    ctx.fillText(this.text, this.tx, this.ty);
  }
};

Firework.prototype.explode = function() {
  this.exploded = true;
  playBoomSound(); // phát âm thanh khi nổ
  let particleCount = 80;

  if (this.type === "circle") {
    for (let i = 0; i < particleCount; i++) {
      let angle = (Math.PI * 2 / particleCount) * i;
      let speed = Math.random() * 3 + 2;
      this.particles.push(new Particle(this.tx, this.ty, angle, speed, this.color));
    }
  } else if (this.type === "heart") {
    for (let i = 0; i < particleCount; i++) {
      let t = i / particleCount * Math.PI * 2;
      let x = 16 * Math.sin(t) ** 3;
      let y = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
      let angle = Math.atan2(y, x);
      let speed = 2.5;
      this.particles.push(new Particle(this.tx, this.ty, angle, speed, this.color));
    }
  } else if (this.type === "flower") {
    for (let i = 0; i < particleCount; i++) {
      let angle = (Math.PI * 2 / particleCount) * i;
      let speed = (i % 2 === 0) ? 3 : 1.5;
      this.particles.push(new Particle(this.tx, this.ty, angle, speed, this.color));
    }
  } else if (this.type === "double") {
    for (let ring = 1; ring <= 2; ring++) {
      for (let i = 0; i < particleCount / 2; i++) {
        let angle = (Math.PI * 2 / (particleCount / 2)) * i;
        let speed = ring * 2;
        this.particles.push(new Particle(this.tx, this.ty, angle, speed, this.color));
      }
    }
  }
};

function Particle(x, y, angle, speed, color) {
  this.x = x;
  this.y = y;
  this.vx = Math.cos(angle) * speed;
  this.vy = Math.sin(angle) * speed;
  this.alpha = 1;
  this.color = color;
}

Particle.prototype.update = function() {
  this.x += this.vx;
  this.y += this.vy;
  this.vx *= 0.98;
  this.vy *= 0.98;
  this.vy += 0.02;
  this.alpha -= 0.01;
};

Particle.prototype.draw = function() {
  ctx.globalAlpha = this.alpha;
  ctx.beginPath();
  ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
  ctx.fillStyle = this.color;
  ctx.fill();
  ctx.globalAlpha = 1;
};

function animate() {
  ctx.fillStyle = "rgba(0,0,0,0.2)";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  fireworks.forEach((fw, i) => {
    fw.update();
    fw.draw();
    if (fw.exploded && fw.particles.length === 0) {
      fireworks.splice(i, 1);
    }
  });

  requestAnimationFrame(animate);
}

setInterval(() => {
  let x = Math.random() * canvas.width;
  let y = Math.random() * (canvas.height / 2);
  let types = ["circle", "heart", "flower", "double"];
  let type = types[Math.floor(Math.random() * types.length)];
  fireworks.push(new Firework(x, y, "❤️ Yêu Em ❤️", type));
}, 800);

animate();
</script>
</body>
</html>
